<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Game</title>
        <style>
            .game {
                position: relative;
                width: 500px;
                height: 500px;
                border: 1px solid #333;
                overflow: hidden; /* Ensure content is clipped within the container */
            }

            .game-role {
                position: absolute;
                width: 50px;
                height: 50px;
                background-color: blue;
                bottom: 0;
                left: 50%;
                transform: translateX(-50%);
            }

            .falling-block {
                position: absolute;
                background-color: red;
                text-align: center;
                font-size: 14px;
                font-weight: bold;
                color: white;
            }
        </style>
        <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    </head>
    <body>
        <div>
            <div class="board">
                <div class="board-time">123</div>
                <div class="board-point">123</div>
            </div>
            <div class="game">
                <div class="game-role"></div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                var game = $('.game');
                var gameRole = $('.game-role');
                var playerWidth = gameRole.width();
                var gameWidth = game.width();
                var playerLeft = parseInt(gameRole.css('left'));
                var moveSpeed = 10;
                var fallingBlockFrequency = 500; // Default frequency (0.5 second)
                var specialBlockFrequency = 8000; // Frequency for special block (8 seconds)
                var specialBlockEffectDuration = 8000; // Duration of the effect of special block ("#")
                var totalScore = 0;
                var timeRemaining = 60; // 1 minute

                // Function to generate a random color
                function getRandomColor() {
                    var letters = '0123456789ABCDEF';
                    var color = '#';
                    for (var i = 0; i < 6; i++) {
                        color += letters[Math.floor(Math.random() * 16)];
                    }
                    return color;
                }

                // Function to create a falling block
                function createFallingBlock() {
                    var block = $('<div class="falling-block"></div>');
                    game.append(block);

                    // Set a random horizontal position within the game container
                    var randomLeft =
                        Math.random() * (game.width() - block.width());
                    block.css('left', randomLeft);

                    // Set a random size based on a number between 1 and 9
                    var blockSize = Math.floor(Math.random() * 9) + 1;
                    var blockDimension = 16 + (25 - 16) * (blockSize / 9);
                    block.width(blockDimension);
                    block.height(blockDimension);

                    // Set a random background color
                    block.css('background-color', getRandomColor());

                    // Set the falling speed based on the block size (1 is slowest, 9 is fastest)
                    var fallingBlockSpeed = blockSize;

                    // Set a random number and display it on the block
                    var randomNumber = Math.floor(Math.random() * 9) + 1;
                    block.text(randomNumber);

                    // Animate the block to move from top to bottom with the calculated speed
                    block.animate(
                        {
                            top: game.height()
                        },
                        {
                            duration: 6000 / fallingBlockSpeed, // Adjust the duration based on speed
                            easing: 'linear',
                            complete: function () {
                                // Remove the block when it reaches the bottom
                                $(this).remove();
                            }
                        }
                    );
                }

                // Function to create a special falling block (with + or # symbol)
                function createSpecialBlock(symbol) {
                    var specialBlock = $(
                        '<div class="falling-block">' + symbol + '</div>'
                    );
                    game.append(specialBlock);

                    // Set a random horizontal position within the game container
                    var randomLeft =
                        Math.random() * (game.width() - specialBlock.width());
                    specialBlock.css('left', randomLeft);

                    // Set size for special block
                    specialBlock.width(25);
                    specialBlock.height(25);

                    // Set background color for special block
                    specialBlock.css(
                        'background-color',
                        symbol === '+' ? 'green' : 'purple'
                    );

                    // Animate the special block to move from top to bottom with a fixed speed
                    specialBlock.animate(
                        {
                            top: game.height()
                        },
                        {
                            duration:
                                symbol === '+'
                                    ? 1500
                                    : specialBlockEffectDuration, // Duration for + symbol, effect duration for # symbol
                            easing: 'linear',
                            complete: function () {
                                // Remove the block when it reaches the bottom
                                $(this).remove();
                            }
                        }
                    );
                }

                // Function to check collision between game-role and falling-block
                function checkCollision() {
                    var gameRolePosition = gameRole.position();
                    $('.falling-block').each(function () {
                        var fallingBlock = $(this);
                        var fallingBlockPosition = fallingBlock.position();

                        if (
                            gameRolePosition.left <
                                fallingBlockPosition.left +
                                    fallingBlock.width() &&
                            gameRolePosition.left + playerWidth >
                                fallingBlockPosition.left &&
                            gameRolePosition.top <
                                fallingBlockPosition.top +
                                    fallingBlock.height() &&
                            gameRolePosition.top + gameRole.height() >
                                fallingBlockPosition.top
                        ) {
                            // Collision detected
                            var blockContent = fallingBlock.text();
                            if (blockContent === '+') {
                                // Special block with + symbol
                                timeRemaining += 5; // Increase time by 5 seconds
                                console.log(
                                    'Special Block! Time Increased: ' +
                                        timeRemaining
                                );
                            } else if (blockContent === '#') {
                                // Special block with # symbol
                                fallingBlockFrequency /= 2; // Double the falling block frequency
                                console.log(
                                    'Special Block! Falling Block Frequency Doubled!'
                                );
                            } else {
                                // Regular block with a number
                                var blockNumber = parseInt(blockContent);
                                totalScore += blockNumber;
                                console.log(
                                    'Collision! Total Score: ' + totalScore
                                );
                                $('.board-point').text(
                                    'Collision! Total Score: ' + totalScore
                                );
                            }

                            fallingBlock.remove();
                        }
                    });
                }

                // Function to update the timer
                function updateTimer() {
                    console.log('Time Remaining: ' + timeRemaining);
                    $('.board-time').text('Time Remaining: ' + timeRemaining);

                    if (timeRemaining <= 0) {
                        // Stop creating falling blocks when time is up
                        clearInterval(fallingBlockInterval);
                        clearInterval(fallingSpecialBlockInterval);

                        // Clear all existing falling blocks
                        $('.falling-block').remove();

                        console.log('Game Over! Total Score: ' + totalScore);
                        $('.board-point').text(
                            'Game Over! Total Score: ' + totalScore
                        );
                    } else {
                        timeRemaining--;
                    }
                }

                // Call createFallingBlock and createSpecialBlock based on fallingBlockFrequency
                var fallingBlockInterval = setInterval(function () {
                    createFallingBlock();
                }, fallingBlockFrequency);

                var fallingSpecialBlockInterval = setInterval(function () {
                    var symbols = ['+', '#']; // Add any new special symbols here
                    var randomSymbol =
                        symbols[Math.floor(Math.random() * symbols.length)];
                    createSpecialBlock(randomSymbol);
                }, specialBlockFrequency);

                // Call checkCollision every 50 milliseconds (adjust as needed)
                setInterval(checkCollision, 50);

                // Call updateTimer every second
                var timerInterval = setInterval(updateTimer, 1000);

                // Move game-role left or right based on keypress
                $(document).keydown(function (e) {
                    if (e.which === 65) {
                        // Move left and constrain within the game container
                        playerLeft = Math.max(playerLeft - moveSpeed, 0);
                        gameRole.css('left', playerLeft + 'px');
                    } else if (e.which === 68) {
                        // Move right and constrain within the game container
                        playerLeft = Math.min(
                            playerLeft + moveSpeed,
                            gameWidth - playerWidth
                        );
                        gameRole.css('left', playerLeft + 'px');
                    }
                });
            });
        </script>
    </body>
</html>
